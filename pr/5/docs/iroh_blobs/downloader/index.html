<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Handle downloading blobs and collections concurrently and from nodes."><title>iroh_blobs::downloader - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-b21aa549bf6d91ff.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="iroh_blobs" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.0-nightly (c987ad527 2024-05-01)" data-channel="nightly" data-search-js="search-bf21c90c8c1d92b1.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-e32f0c247825364d.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-09095024cf37855e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../iroh_blobs/index.html">iroh_blobs</a><span class="version">0.27.0</span></h2></div><h2 class="location"><a href="#">Module downloader</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></section><h2><a href="../index.html">In crate iroh_blobs</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../iroh_blobs/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Type ‘S’ or ‘/’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings">Settings</a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">iroh_blobs</a>::<wbr><a class="mod" href="#">downloader</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/iroh_blobs/downloader.rs.html#1-1514">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><span class="item-info"><div class="stab portability">Available on <strong>crate feature <code>downloader</code></strong> only.</div></span><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Handle downloading blobs and collections concurrently and from nodes.</p>
<p>The <a href="struct.Downloader.html" title="struct iroh_blobs::downloader::Downloader"><code>Downloader</code></a> interacts with four main components to this end.</p>
<ul>
<li><a href="trait.Dialer.html" title="trait iroh_blobs::downloader::Dialer"><code>Dialer</code></a>: Used to queue opening connections to nodes we need to perform downloads.</li>
<li><code>ProviderMap</code>: Where the downloader obtains information about nodes that could be
used to perform a download.</li>
<li><a href="../store/trait.Store.html" title="trait iroh_blobs::store::Store"><code>Store</code></a>: Where data is stored.</li>
</ul>
<p>Once a download request is received, the logic is as follows:</p>
<ol>
<li>The <code>ProviderMap</code> is queried for nodes. From these nodes some are selected
prioritizing connected nodes with lower number of active requests. If no useful node is
connected, or useful connected nodes have no capacity to perform the request, a connection
attempt is started using the <a href="trait.Dialer.html" title="trait iroh_blobs::downloader::Dialer"><code>Dialer</code></a>.</li>
<li>The download is queued for processing at a later time. Downloads are not performed right
away. Instead, they are initially delayed to allow the node to obtain the data itself, and
to wait for the new connection to be established if necessary.</li>
<li>Once a request is ready to be sent after a delay (initial or for a retry), the preferred
node is used if available. The request is now considered active.</li>
</ol>
<p>Concurrency is limited in different ways:</p>
<ul>
<li><em>Total number of active request:</em> This is a way to prevent a self DoS by overwhelming our own
bandwidth capacity. This is a best effort heuristic since it doesn’t take into account how
much data we are actually requesting or receiving.</li>
<li><em>Total number of connected nodes:</em> Peer connections are kept for a longer time than they are
strictly needed since it’s likely they will be useful soon again.</li>
<li><em>Requests per node</em>: to avoid overwhelming nodes with requests, the number of concurrent
requests to a single node is also limited.</li>
</ul>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.ConcurrencyLimits.html" title="struct iroh_blobs::downloader::ConcurrencyLimits">ConcurrencyLimits</a></div><div class="desc docblock-short">Concurrency limits for the <a href="struct.Downloader.html" title="struct iroh_blobs::downloader::Downloader"><code>Downloader</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.DownloadHandle.html" title="struct iroh_blobs::downloader::DownloadHandle">DownloadHandle</a></div><div class="desc docblock-short">Handle to interact with a download request.</div></li><li><div class="item-name"><a class="struct" href="struct.DownloadKind.html" title="struct iroh_blobs::downloader::DownloadKind">DownloadKind</a></div><div class="desc docblock-short">The kind of resource to download.</div></li><li><div class="item-name"><a class="struct" href="struct.DownloadRequest.html" title="struct iroh_blobs::downloader::DownloadRequest">DownloadRequest</a></div><div class="desc docblock-short">A download request.</div></li><li><div class="item-name"><a class="struct" href="struct.Downloader.html" title="struct iroh_blobs::downloader::Downloader">Downloader</a></div><div class="desc docblock-short">Handle for the download services.</div></li><li><div class="item-name"><a class="struct" href="struct.IntentId.html" title="struct iroh_blobs::downloader::IntentId">IntentId</a></div><div class="desc docblock-short">Identifier for a download intent.</div></li><li><div class="item-name"><a class="struct" href="struct.RetryConfig.html" title="struct iroh_blobs::downloader::RetryConfig">RetryConfig</a></div><div class="desc docblock-short">Configuration for retry behavior of the <a href="struct.Downloader.html" title="struct iroh_blobs::downloader::Downloader"><code>Downloader</code></a>.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.DownloadError.html" title="enum iroh_blobs::downloader::DownloadError">DownloadError</a></div><div class="desc docblock-short">Error returned when a download could not be completed.</div></li><li><div class="item-name"><a class="enum" href="enum.FailureAction.html" title="enum iroh_blobs::downloader::FailureAction">FailureAction</a></div><div class="desc docblock-short">Signals what should be done with the request when it fails.</div></li><li><div class="item-name"><a class="enum" href="enum.GetOutput.html" title="enum iroh_blobs::downloader::GetOutput">GetOutput</a></div><div class="desc docblock-short">Output returned from <a href="trait.Getter.html#tymethod.get" title="method iroh_blobs::downloader::Getter::get"><code>Getter::get</code></a>.</div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.Dialer.html" title="trait iroh_blobs::downloader::Dialer">Dialer</a></div><div class="desc docblock-short">Trait modeling a dialer. This allows for IO-less testing.</div></li><li><div class="item-name"><a class="trait" href="trait.Getter.html" title="trait iroh_blobs::downloader::Getter">Getter</a></div><div class="desc docblock-short">Trait modelling performing a single request over a connection. This allows for IO-less testing.</div></li><li><div class="item-name"><a class="trait" href="trait.NeedsConn.html" title="trait iroh_blobs::downloader::NeedsConn">NeedsConn</a></div><div class="desc docblock-short">Trait modelling the intermediary state when a connection is needed to proceed.</div></li></ul></section></div></main></body></html>