<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="An async batch interface for writing bao content items to a pair of data and outboard."><title>BaoBatchWriter in iroh_blobs::store - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-b21aa549bf6d91ff.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="iroh_blobs" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.0-nightly (c987ad527 2024-05-01)" data-channel="nightly" data-search-js="search-bf21c90c8c1d92b1.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-e32f0c247825364d.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-09095024cf37855e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../iroh_blobs/index.html">iroh_blobs</a><span class="version">0.27.0</span></h2></div><h2 class="location"><a href="#">BaoBatchWriter</a></h2><div class="sidebar-elems"><section><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.sync">sync</a></li><li><a href="#tymethod.write_batch">write_batch</a></li></ul><h3><a href="#foreign-impls">Implementations on Foreign Types</a></h3><ul class="block"><li><a href="#impl-BaoBatchWriter-for-%26mut+W">&amp;mut W</a></li></ul><h3><a href="#object-safety">Object Safety</a></h3><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In iroh_blobs::store</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../iroh_blobs/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Type ‘S’ or ‘/’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings">Settings</a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="../index.html">iroh_blobs</a>::<wbr><a href="index.html">store</a>::<wbr><a class="trait" href="#">BaoBatchWriter</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/iroh_blobs/store/traits.rs.html#129-159">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait BaoBatchWriter {
    // Required methods
    fn <a href="#tymethod.write_batch" class="fn">write_batch</a>(
        &amp;mut self,
        size: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>,
        batch: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;BaoContentItem&gt;
    ) -&gt; impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="type" href="https://doc.rust-lang.org/nightly/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.sync" class="fn">sync</a>(&amp;mut self) -&gt; impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="type" href="https://doc.rust-lang.org/nightly/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;&gt;;
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>An async batch interface for writing bao content items to a pair of data and
outboard.</p>
<p>Details like the chunk group size and the actual storage location are left
to the implementation.</p>
</div></details><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.write_batch" class="method"><a class="src rightside" href="../../src/iroh_blobs/store/traits.rs.html#149-153">source</a><h4 class="code-header">fn <a href="#tymethod.write_batch" class="fn">write_batch</a>(
    &amp;mut self,
    size: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>,
    batch: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;BaoContentItem&gt;
) -&gt; impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="type" href="https://doc.rust-lang.org/nightly/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;&gt;</h4></section></summary><div class="docblock"><p>Write a batch of bao content items to the underlying storage.</p>
<p>The batch is guaranteed to be sorted as data is received from the network.
So leaves will be sorted by offset, and parents will be sorted by pre order
traversal offset. There is no guarantee that they will be consecutive
though.</p>
<p>The size is the total size of the blob that the remote side told us.
It is not guaranteed to be correct, but it is guaranteed to be
consistent with all data in the batch. The size therefore represents
an upper bound on the maximum offset of all leaf items.
So it is guaranteed that <code>leaf.offset + leaf.size &lt;= size</code> for all
leaf items in the batch.</p>
<p>Batches should not become too large. Typically, a batch is just a few
parent nodes and a leaf.</p>
<p>Batch is a vec so it can be moved into a task, which is unfortunately
necessary in typical io code.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.sync" class="method"><a class="src rightside" href="../../src/iroh_blobs/store/traits.rs.html#158">source</a><h4 class="code-header">fn <a href="#tymethod.sync" class="fn">sync</a>(&amp;mut self) -&gt; impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="type" href="https://doc.rust-lang.org/nightly/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;&gt;</h4></section></summary><div class="docblock"><p>Sync the written data to permanent storage, if applicable.
E.g. for a file based implementation, this would call sync_data
on all files.</p>
</div></details></div><h2 id="object-safety" class="section-header">Object Safety<a href="#object-safety" class="anchor">§</a></h2><div class="object-safety-info">This trait is <b>not</b> <a href="https://doc.rust-lang.org/nightly/reference/items/traits.html#object-safety">object safe</a>.</div><h2 id="foreign-impls" class="section-header">Implementations on Foreign Types<a href="#foreign-impls" class="anchor">§</a></h2><details class="toggle implementors-toggle"><summary><section id="impl-BaoBatchWriter-for-%26mut+W" class="impl"><a class="src rightside" href="../../src/iroh_blobs/store/traits.rs.html#162-170">source</a><a href="#impl-BaoBatchWriter-for-%26mut+W" class="anchor">§</a><h3 class="code-header">impl&lt;W: <a class="trait" href="trait.BaoBatchWriter.html" title="trait iroh_blobs::store::BaoBatchWriter">BaoBatchWriter</a>&gt; <a class="trait" href="trait.BaoBatchWriter.html" title="trait iroh_blobs::store::BaoBatchWriter">BaoBatchWriter</a> for <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut W</a></h3></section></summary><div class="docblock"><p>Implement BaoBatchWriter for mutable references</p>
</div><div class="impl-items"><section id="method.write_batch" class="method trait-impl"><a class="src rightside" href="../../src/iroh_blobs/store/traits.rs.html#163-165">source</a><a href="#method.write_batch" class="anchor">§</a><h4 class="code-header">async fn <a href="#tymethod.write_batch" class="fn">write_batch</a>(
    &amp;mut self,
    size: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>,
    batch: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;BaoContentItem&gt;
) -&gt; <a class="type" href="https://doc.rust-lang.org/nightly/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;</h4></section><section id="method.sync" class="method trait-impl"><a class="src rightside" href="../../src/iroh_blobs/store/traits.rs.html#167-169">source</a><a href="#method.sync" class="anchor">§</a><h4 class="code-header">async fn <a href="#tymethod.sync" class="fn">sync</a>(&amp;mut self) -&gt; <a class="type" href="https://doc.rust-lang.org/nightly/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;</h4></section></div></details><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"></div><script src="../../trait.impl/iroh_blobs/store/traits/trait.BaoBatchWriter.js" async></script></section></div></main></body></html>